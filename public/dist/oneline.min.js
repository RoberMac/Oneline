angular.module("Oneline",["ngTouch","ngResource","ui.router","angular-jwt","angular-storage","linkify","Oneline.rootControllers","Oneline.settingsControllers","Oneline.timelineControllers","Oneline.timelineServices","Oneline.relativeDateServices","Oneline.tokenHelperServices","Oneline.UIServices","Oneline.templateTwitterDirectives"]).config(["$locationProvider","$stateProvider","$urlRouterProvider","$httpProvider","jwtInterceptorProvider",function(e,t,r,i,n){e.html5Mode(!0),n.tokenGetter=function(){return localStorage.getItem("tokenList")},i.interceptors.push("jwtInterceptor"),r.otherwise("/"),t.state("settings",{url:"/?s",templateUrl:"/public/dist/settings.min.html",controller:"settingsCtrl"}).state("timeline",{url:"/{provider:all|twitter|instagram|weibo}",templateUrl:"/public/dist/timeline.min.html",controller:"timelineCtrl"})}]);
angular.module("Oneline.templateTwitterDirectives",[]).directive("tweet",function(){return{restrict:"E",transclude:!0,templateUrl:"/public/dist/tweet.min.html"}}).directive("tweetQuote",function(){return{restrict:"E",templateUrl:"/public/dist/tweet--quote.min.html"}}).directive("tweetRetweet",function(){return{restrict:"E",templateUrl:"/public/dist/tweet--retweet.min.html"}}).directive("igPost",function(){return{restrict:"E",templateUrl:"/public/dist/ig-post.min.html"}});
angular.module("Oneline.UIServices",[]).service("olUI",function(){});
angular.module("Oneline.relativeDateServices",["relativeDate"]).value("relativeDateTranslations",{just_now:"0s",seconds_ago:"{{time}}s",a_minute_ago:"1m",minutes_ago:"{{time}}m",an_hour_ago:"1h",hours_ago:"{{time}}h",a_day_ago:"1d",days_ago:"{{time}}d",a_week_ago:"1w",weeks_ago:"{{time}}w",a_month_ago:"1M",months_ago:"{{time}}M",a_year_ago:"1y",years_ago:"{{time}}y",over_a_year_ago:"> 1y",seconds_from_now:"+ {{time}}s",a_minute_from_now:"+ 1m",minutes_from_now:"+ {{time}}m",an_hour_from_now:"+ 1h",hours_from_now:"+ {{time}}h",a_day_from_now:"+ 1d",days_from_now:"+ {{time}}d",a_week_from_now:"+ 1w",weeks_from_now:"+ {{time}}w",a_month_from_now:"+ 1M",months_from_now:"+ {{time}}M",a_year_from_now:"+ 1y",years_from_now:"+ {{time}}y",over_a_year_from_now:"++ 1y"}).directive("relativeDate",["$timeout","$filter",function(e,o){return function(a,_,t){function n(){_.text(o("relativeDate")(i)),6e4>s&&new Date-Date.parse(i)>6e4&&(s=6e4)}function m(){r=e(function(){n(),m()},s)}var r,i=t.relativeDate,s=1e3;_.bind("$destroy",function(){e.cancel(r)}),n(),m()}}]);
angular.module("Oneline.timelineServices",[]).factory("Timeline",["$resource",function(e){return e("/timeline/:id")}]);
angular.module("Oneline.tokenHelperServices",[]).service("olTokenHelper",["jwtHelper","store",function(e,n){this.addToken=function(){var t=localStorage.getItem("addToken"),r=e.decodeToken(t).provider,i=n.get("tokenList")||[];i=o.removeToken(i,r),i.push(t),n.set("tokenList",i),n.remove("addToken")},this.removeToken=function(e){var t=n.get("tokenList")||[];t=o.removeToken(t,e),n.set("tokenList",t)},this.clearToken=function(){n.remove("tokenList")},this.getProviderList=function(){var o=n.get("tokenList")||[];return o.map(function(n){return e.decodeToken(n).provider})},this.isValidToken=function(){var o=n.get("tokenList")||[];return o.some(function(n){return!e.isTokenExpired(n)})};var o={removeToken:function(n,o){return n.filter(function(n){return o!==e.decodeToken(n).provider})}}}]);
angular.module("Oneline.rootControllers",[]).controller("rootController",["$scope","$timeout","store","olTokenHelper",function(e,i,r,o){e.providerList=o.getProviderList(),e.isTimeline=!1,e.timelineProvider=r.get("timelineProvider")||"all",r.set("timelineProvider",e.timelineProvider),e.updateProviderList=function(){i(function(){e.providerList=o.getProviderList()})},e.setTimeline=function(i){e.isTimeline=i},e.isAuth=function(i){return e.providerList.indexOf(i)>=0}}]);
angular.module("Oneline.settingsControllers",[]).controller("settingsCtrl",["$scope","$window","$state","$stateParams","store","olTokenHelper",function(e,t,n,o,i,r){r.isValidToken()&&"1"!==o.s?n.go("timeline",{provider:i.get("timelineProvider")}):null,e.setTimeline(!1),t.addEventListener("storage",function(t){"addToken"===t.key&&(r.addToken(),e.updateProviderList())}),e.toggleAuth=function(n){e.providerList.indexOf(n)<0?t.open("/auth/"+n,"_blank"):(r.removeToken(n),e.updateProviderList())}}]);
angular.module("Oneline.timelineControllers",[]).controller("timelineCtrl",["$scope","$state","$stateParams","store","Timeline","olTokenHelper",function(e,t,r,a,i,s){function n(e){var t=[];return e.forEach(function(e){var r={provider:"twitter",created_at:e.created_at,id_str:e.id_str,user:e.user};e.in_reply_to_status_id?angular.extend(r,{type:"reply",text:e.text}):e.retweeted_status?angular.extend(r,{type:"retweet",retweet:{created_at:e.retweeted_status.created_at,text:e.retweeted_status.text,user:e.retweeted_status.user}}):e.quoted_status_id?angular.extend(r,{type:"quote",text:e.text,quote:{created_at:e.quoted_status.created_at,id_str:e.quoted_status.id_str,text:e.quoted_status.text,user:e.quoted_status.user}}):angular.extend(r,{type:"tweet",text:e.text}),t.push(r)}),t}function d(e){var t=[];return e.forEach(function(e){var r={provider:"instagram",created_at:new Date(1e3*e.created_time).toString(),type:e.type,id_str:e.id,user:e.user,text:e.caption&&e.caption.text?e.caption.text:null};"image"===e.type?angular.extend(r,{images_src:e.images.standard_resolution.url}):"video"===e.type&&angular.extend(r,{images_src:e.images.standard_resolution.url,videos_src:e.videos.standard_resolution.url}),t.push(r)}),t}function o(e){a.set("timelineProvider",e),t.go("timeline",{provider:e})}s.isValidToken()?null:t.go("settings",{settings:"settings"}),e.setTimeline(!0),e.providerList.indexOf(r.provider)>=0||"all"===r.provider?o(r.provider):t.go("timeline",{provider:a.get("timelineProvider")}),e.timelineData=[],i.query(function(t){e.timelineData=t[0].created_time?d(t):n(t)})}]);
//# sourceMappingURL=oneline.min.js.map